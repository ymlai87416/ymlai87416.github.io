<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Zookeeper - Tom personal site</title><meta name=Description content="Tom personal web site"><meta property="og:title" content="Zookeeper"><meta property="og:description" content="Zookeeper ZooKeeper源码分析与实战 etcd is used by kubernetes for the same purpose etcd和Zookeeper孰优孰劣？ Handle Request Request SyncRequestProcessor Snapshot decided by how big log count and log size. PrepRequestProcessor FinalRequestProcessor Data structure ZooKeeper （四） 源码剖"><meta property="og:type" content="article"><meta property="og:url" content="https://ymlai87416.github.io/opensource/zookeeper/"><meta property="og:image" content="https://ymlai87416.github.io/logo.png"><meta property="article:section" content="opensource"><meta property="article:published_time" content="2022-08-21T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-21T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ymlai87416.github.io/logo.png"><meta name=twitter:title content="Zookeeper"><meta name=twitter:description content="Zookeeper ZooKeeper源码分析与实战 etcd is used by kubernetes for the same purpose etcd和Zookeeper孰优孰劣？ Handle Request Request SyncRequestProcessor Snapshot decided by how big log count and log size. PrepRequestProcessor FinalRequestProcessor Data structure ZooKeeper （四） 源码剖"><meta name=application-name content="Tom personal web site"><meta name=apple-mobile-web-app-title content="Tom personal web site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://ymlai87416.github.io/opensource/zookeeper/><link rel=next href=https://ymlai87416.github.io/opensource/webserver/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Zookeeper","inLanguage":"zh","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/ymlai87416.github.io\/opensource\/zookeeper\/"},"image":["https:\/\/ymlai87416.github.io\/images\/Apple-Devices-Preview.png"],"genre":"opensource","wordcount":181,"url":"https:\/\/ymlai87416.github.io\/opensource\/zookeeper\/","datePublished":"2022-08-21T00:00:00+00:00","dateModified":"2022-08-21T00:00:00+00:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"Tom","logo":"https:\/\/ymlai87416.github.io\/images\/avatar.jpg"},"author":{"@type":"Person","name":"Tom"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Tom personal site">Tom personal site</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/about/>About </a><a class=menu-item href=/blog/>Blog </a><a class=menu-item href=/cheatsheet/>Cheatsheet </a><a class=menu-item href=/tools/>Tools </a><a class=menu-item href=/link/>Link </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title>
<i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Tom personal site">Tom personal site</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/about/ title>About</a><a class=menu-item href=/blog/ title>Blog</a><a class=menu-item href=/cheatsheet/ title>Cheatsheet</a><a class=menu-item href=/tools/ title>Tools</a><a class=menu-item href=/link/ title>Link</a><a href=javascript:void(0); class="menu-item theme-switch" title>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class="page single special"><h1 class="single-title animated pulse faster">Zookeeper</h1><div class=content id=content><h1 id=zookeeper>Zookeeper</h1><p><a href=https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/ZooKeeper%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B8%8E%E5%AE%9E%E6%88%98-%E5%AE%8C target=_blank rel="noopener noreffer">ZooKeeper源码分析与实战</a></p><p>etcd is used by kubernetes for the same purpose
<a href=https://www.modb.pro/db/323785 target=_blank rel="noopener noreffer">etcd和Zookeeper孰优孰劣？</a></p><h2 id=handle-request>Handle Request</h2><ul><li><p><i class="far fa-square fa-fw"></i> <a href=https://github.com/apache/zookeeper/blob/master/zookeeper-server/src/main/java/org/apache/zookeeper/server/Request.java target=_blank rel="noopener noreffer">Request</a></p></li><li><p><i class="far fa-square fa-fw"></i> <a href=https://github.com/apache/zookeeper/blob/master/zookeeper-server/src/main/java/org/apache/zookeeper/server/SyncRequestProcessor.java target=_blank rel="noopener noreffer">SyncRequestProcessor</a></p><p>Snapshot decided by how big log count and log size.</p></li><li><p><i class="far fa-square fa-fw"></i> <a href=https://github.com/apache/zookeeper/blob/master/zookeeper-server/src/main/java/org/apache/zookeeper/server/PrepRequestProcessor.java target=_blank rel="noopener noreffer">PrepRequestProcessor</a></p></li><li><p><i class="far fa-square fa-fw"></i> <a href=https://github.com/apache/zookeeper/blob/master/zookeeper-server/src/main/java/org/apache/zookeeper/server/FinalRequestProcessor.java target=_blank rel="noopener noreffer">FinalRequestProcessor</a></p></li></ul><h2 id=data-structure>Data structure</h2><p><a href=https://juejin.cn/post/6844904163646652430 target=_blank rel="noopener noreffer">ZooKeeper （四） 源码剖析：数据模型和存储</a></p><ul><li><p><i class="far fa-square fa-fw"></i> <a href=https://github.com/apache/zookeeper/tree/master/zookeeper-server/src/main/java/org/apache/zookeeper/server/ZKDatabase.java target=_blank rel="noopener noreffer">ZKDatabase</a></p></li><li><p><i class="far fa-square fa-fw"></i> <a href=https://github.com/apache/zookeeper/blob/master/zookeeper-server/src/main/java/org/apache/zookeeper/server/DataTree.java target=_blank rel="noopener noreffer">DataTree</a></p><p>This is where the data is stored.</p></li><li><p><i class="far fa-square fa-fw"></i> <a href=https://github.com/apache/zookeeper/blob/master/zookeeper-server/src/main/java/org/apache/zookeeper/server/persistence/FileTxnSnapLog.java target=_blank rel="noopener noreffer">FileTxnSnapLog</a></p><p>Single thread block write?</p></li></ul><h2 id=network>Network</h2><p><a href=https://juejin.cn/post/6844904159167283213O target=_blank rel="noopener noreffer">ZooKeeper （三）源码剖析: 服务端网络连接层 NIO</a></p><p>NIO Mechanism: <a href=https://github.com/apache/zookeeper/blob/master/zookeeper-server/src/main/java/org/apache/zookeeper/server/NIOServerCnxnFactory.java target=_blank rel="noopener noreffer">NIOServerCnxnFactory.java</a></p><h2 id=watch-node>Watch node</h2><p>The actual implementation is at <a href=https://github.com/apache/zookeeper/blob/2cd0c23454071faf0a16c58edb2414591ae5c5c3/zookeeper-server/src/main/java/org/apache/zookeeper/server/ZKDatabase.java#L526 target=_blank rel="noopener noreffer">ZKDatabase</a> with the help of the DataTree</p><h2 id=election>Election</h2><p><a href=https://juejin.cn/post/6844904152804360200 target=_blank rel="noopener noreffer">ZooKeeper（二） 源码剖析: 群首选举</a></p><h2 id=zab>ZAB</h2><p><a href=https://juejin.cn/post/6844904191194824711 target=_blank rel="noopener noreffer">Zookeeper (五) 源码剖析: Zab 协议</a></p><p>Leader -> request -> get ack -> send commit -> done</p><ul><li><p><i class="far fa-square fa-fw"></i> <a href=https://github.com/apache/zookeeper/blob/master/zookeeper-server/src/main/java/org/apache/zookeeper/server/quorum/ProposalRequestProcessor.java target=_blank rel="noopener noreffer">ProposalRequestProcessor</a></p></li><li><p><i class="far fa-square fa-fw"></i> <a href=https://github.com/apache/zookeeper/blob/master/zookeeper-server/src/main/java/org/apache/zookeeper/server/quorum/CommitProcessor.java target=_blank rel="noopener noreffer">CommitRequest</a> (under quorum)</p></li><li><p><i class="far fa-square fa-fw"></i> <a href=https://github.com/apache/zookeeper/blob/master/zookeeper-server/src/main/java/org/apache/zookeeper/server/quorum/AckRequestProcessor.java target=_blank rel="noopener noreffer">AckRequestProcessor</a></p></li><li><p><i class="far fa-square fa-fw"></i> FinalRequest</p></li></ul></div></div></div></main><footer class=footer><div class=footer-container><div class=footer-line></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2016 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Lai Yiu Ming, Tom</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"",maxShownLines:100},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>