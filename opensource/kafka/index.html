<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Kafka - Tom personal site</title><meta name=Description content="Tom personal web site"><meta property="og:title" content="Kafka"><meta property="og:description" content="Kafka Producer KafkaProducer Sender NetworkClient Consumer KafkaConsumer Fetcher How Kafka keep things in kernel Kafka中Zero-Copy的相关总结 Kafka零拷贝 FileRecords The code finally reach a called ByteBuffer.allocateDirect() Direct vs. non-direct buffers A byte buffer is either direct or non-direct. Given a direct byte buffer, the Java virtual"><meta property="og:type" content="article"><meta property="og:url" content="https://www.ymlai87416.com/opensource/kafka/"><meta property="og:image" content="https://www.ymlai87416.com/logo.png"><meta property="article:section" content="opensource"><meta property="article:published_time" content="2022-08-21T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-21T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.ymlai87416.com/logo.png"><meta name=twitter:title content="Kafka"><meta name=twitter:description content="Kafka Producer KafkaProducer Sender NetworkClient Consumer KafkaConsumer Fetcher How Kafka keep things in kernel Kafka中Zero-Copy的相关总结 Kafka零拷贝 FileRecords The code finally reach a called ByteBuffer.allocateDirect() Direct vs. non-direct buffers A byte buffer is either direct or non-direct. Given a direct byte buffer, the Java virtual"><meta name=application-name content="Tom personal web site"><meta name=apple-mobile-web-app-title content="Tom personal web site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.ymlai87416.com/opensource/kafka/><link rel=prev href=https://www.ymlai87416.com/opensource/linux/><link rel=next href=https://www.ymlai87416.com/opensource/jdk/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Kafka","inLanguage":"zh","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.ymlai87416.com\/opensource\/kafka\/"},"image":["https:\/\/www.ymlai87416.com\/images\/Apple-Devices-Preview.png"],"genre":"opensource","wordcount":340,"url":"https:\/\/www.ymlai87416.com\/opensource\/kafka\/","datePublished":"2022-08-21T00:00:00+00:00","dateModified":"2022-08-21T00:00:00+00:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"Tom","logo":"https:\/\/www.ymlai87416.com\/images\/avatar.jpg"},"author":{"@type":"Person","name":"Tom"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Tom personal site">Tom personal site</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/about/>About </a><a class=menu-item href=/blog/>Blog </a><a class=menu-item href=/cheatsheet/>Cheatsheet </a><a class=menu-item href=/tools/>Tools </a><a class=menu-item href=/link/>Link </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title>
<i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Tom personal site">Tom personal site</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/about/ title>About</a><a class=menu-item href=/blog/ title>Blog</a><a class=menu-item href=/cheatsheet/ title>Cheatsheet</a><a class=menu-item href=/tools/ title>Tools</a><a class=menu-item href=/link/ title>Link</a><a href=javascript:void(0); class="menu-item theme-switch" title>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class="page single special"><h1 class="single-title animated pulse faster">Kafka</h1><div class=content id=content><h1 id=kafka>Kafka</h1><h2 id=producer>Producer</h2><ul><li><i class="far fa-square fa-fw"></i> <a href=https://github.com/ymlai87416-oss/kafka/blob/150fd5b0b18c4761d8f7d7ba9a480aa9f622024f/clients/src/main/java/org/apache/kafka/clients/producer/KafkaProducer.java#L469 target=_blank rel="noopener noreffer">KafkaProducer</a></li><li><i class="far fa-square fa-fw"></i> <a href=https://github.com/ymlai87416-oss/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/producer/internals/Sender.java target=_blank rel="noopener noreffer">Sender</a></li><li><i class="far fa-square fa-fw"></i> <a href=https://github.com/ymlai87416-oss/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/NetworkClient.java target=_blank rel="noopener noreffer">NetworkClient</a></li></ul><h2 id=consumer>Consumer</h2><ul><li><i class="far fa-square fa-fw"></i> <a href=https://github.com/ymlai87416-oss/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/consumer/KafkaConsumer.java target=_blank rel="noopener noreffer">KafkaConsumer</a></li><li><i class="far fa-square fa-fw"></i> <a href=https://github.com/ymlai87416-oss/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/consumer/internals/Fetcher.java target=_blank rel="noopener noreffer">Fetcher</a></li></ul><h2 id=how-kafka-keep-things-in-kernel>How Kafka keep things in kernel</h2><p><a href=https://blog.csdn.net/funnyrand/article/details/125513774 target=_blank rel="noopener noreffer">Kafka中Zero-Copy的相关总结</a>
<a href=https://zhuanlan.zhihu.com/p/78335525 target=_blank rel="noopener noreffer">Kafka零拷贝</a></p><ul><li><p><i class="far fa-square fa-fw"></i> <a href=https://github.com/ymlai87416-oss/kafka/blob/150fd5b0b18c4761d8f7d7ba9a480aa9f622024f/clients/src/main/java/org/apache/kafka/common/record/FileRecords.java#L294 target=_blank rel="noopener noreffer">FileRecords</a></p><p>The code finally reach a called ByteBuffer.allocateDirect()</p><p>Direct vs. non-direct buffers
A byte buffer is either direct or non-direct. Given a direct byte buffer, the Java virtual machine will make a best effort to perform native I/O operations directly upon it. That is, it will attempt to avoid copying the buffer&rsquo;s content to (or from) an intermediate buffer before (or after) each invocation of one of the underlying operating system&rsquo;s native I/O operations.</p><p>A direct byte buffer may be created by invoking the allocateDirect factory method of this class. The buffers returned by this method typically have somewhat higher allocation and deallocation costs than non-direct buffers. The contents of direct buffers may reside outside of the normal garbage-collected heap, and so their impact upon the memory footprint of an application might not be obvious. It is therefore recommended that direct buffers be allocated primarily for large, long-lived buffers that are subject to the underlying system&rsquo;s native I/O operations. In general it is best to allocate direct buffers only when they yield a measureable gain in program performance.</p><p>A direct byte buffer may also be created by mapping a region of a file directly into memory. An implementation of the Java platform may optionally support the creation of direct byte buffers from native code via JNI. If an instance of one of these kinds of buffers refers to an inaccessible region of memory then an attempt to access that region will not change the buffer&rsquo;s content and will cause an unspecified exception to be thrown either at the time of the access or at some later time.</p><p>Whether a byte buffer is direct or non-direct may be determined by invoking its isDirect method. This method is provided so that explicit buffer management can be done in performance-critical code.</p></li></ul></div></div></div></main><footer class=footer><div class=footer-container><div class=footer-line></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2016 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Lai Yiu Ming, Tom</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"",maxShownLines:100},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>