<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Upgrade Kubernetes from 1.20 to 1.21 - Tom personal site</title><meta name=Description content="Tom personal web site"><meta property="og:title" content="Upgrade Kubernetes from 1.20 to 1.21"><meta property="og:description" content="I am writing to document the upgrade process from Kubernetes 1.20 to 1.21.
Seems I am expected to upgrade Kubernetes at least semi-annually, in order to play catch up with the fast evolving versions&mldr;
Kubernetes end of life schedule
Current setup 3 Raspberry pi as master node. use Keepalived for HA.
Ubuntu 20.04 LTS (arm), docker version 1.4.4-1, kubernetes version 1.20.5
1 x86_64 VM node as worker node.
Ubuntu 20.04 LTS (x86_64), docker version 1."><meta property="og:type" content="article"><meta property="og:url" content="https://ymlai87416.github.io/blog/upgrade-k8s-v120/"><meta property="og:image" content="https://ymlai87416.github.io/logo.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-04-10T08:36:47+01:00"><meta property="article:modified_time" content="2022-04-10T08:36:47+01:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ymlai87416.github.io/logo.png"><meta name=twitter:title content="Upgrade Kubernetes from 1.20 to 1.21"><meta name=twitter:description content="I am writing to document the upgrade process from Kubernetes 1.20 to 1.21.
Seems I am expected to upgrade Kubernetes at least semi-annually, in order to play catch up with the fast evolving versions&mldr;
Kubernetes end of life schedule
Current setup 3 Raspberry pi as master node. use Keepalived for HA.
Ubuntu 20.04 LTS (arm), docker version 1.4.4-1, kubernetes version 1.20.5
1 x86_64 VM node as worker node.
Ubuntu 20.04 LTS (x86_64), docker version 1."><meta name=application-name content="Tom personal web site"><meta name=apple-mobile-web-app-title content="Tom personal web site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://ymlai87416.github.io/blog/upgrade-k8s-v120/><link rel=prev href=https://ymlai87416.github.io/blog/multi-node-k8s-failed/><link rel=next href=https://ymlai87416.github.io/blog/k8s-move-to-containerd/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Upgrade Kubernetes from 1.20 to 1.21","inLanguage":"zh","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/ymlai87416.github.io\/blog\/upgrade-k8s-v120\/"},"image":["https:\/\/ymlai87416.github.io\/images\/Apple-Devices-Preview.png"],"genre":"blog","keywords":"computer science, infrastructure","wordcount":2966,"url":"https:\/\/ymlai87416.github.io\/blog\/upgrade-k8s-v120\/","datePublished":"2022-04-10T08:36:47+01:00","dateModified":"2022-04-10T08:36:47+01:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"Tom","logo":"https:\/\/ymlai87416.github.io\/images\/avatar.jpg"},"author":{"@type":"Person","name":"Lai Yiu Ming, Tom"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Tom personal site">Tom personal site</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/about/>About </a><a class=menu-item href=/blog/>Blog </a><a class=menu-item href=/cheatsheet/>Cheatsheet </a><a class=menu-item href=/tools/>Tools </a><a class=menu-item href=/link/>Link </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title>
<i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Tom personal site">Tom personal site</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/about/ title>About</a><a class=menu-item href=/blog/ title>Blog</a><a class=menu-item href=/cheatsheet/ title>Cheatsheet</a><a class=menu-item href=/tools/ title>Tools</a><a class=menu-item href=/link/ title>Link</a><a href=javascript:void(0); class="menu-item theme-switch" title>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title></h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Upgrade Kubernetes from 1.20 to 1.21</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Lai Yiu Ming, Tom</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-04-10>2022-04-10</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span></span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#current-setup>Current setup</a></li><li><a href=#target>Target</a></li><li><a href=#upgrade-process>Upgrade process</a><ul><li><a href=#upgrade-first-master-node>Upgrade first master node</a></li><li><a href=#upgrade-other-master-nodes>Upgrade other master nodes</a></li><li><a href=#checkpoint---master-nodes>Checkpoint - master nodes</a></li><li><a href=#upgrade-worker-nodes>Upgrade worker nodes</a></li><li><a href=#final-health-check>Final health check</a></li><li><a href=#upgrade-also-containerdio>Upgrade also containerd.io</a></li></ul></li><li><a href=#useful-command>Useful command</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></div><div class=content id=content><p>I am writing to document the upgrade process from Kubernetes 1.20 to 1.21.</p><p>Seems I am expected to upgrade Kubernetes at least semi-annually, in order to play catch up with the fast evolving versions&mldr;</p><p><a href=https://endoflife.date/kubernetes target=_blank rel="noopener noreffer">Kubernetes end of life schedule</a></p><h2 id=current-setup>Current setup</h2><ul><li><p>3 Raspberry pi as master node. use Keepalived for HA.</p><p>Ubuntu 20.04 LTS (arm), docker version 1.4.4-1, kubernetes version 1.20.5</p></li><li><p>1 x86_64 VM node as worker node.</p><p>Ubuntu 20.04 LTS (x86_64), docker version 1.4.4-1, kubernetes version 1.20.5</p></li></ul><p>All machines hold the following packages: kubeadm, kubelet, kubectl, containerd.io</p><h2 id=target>Target</h2><p>Upgrade all nodes to</p><ul><li>Kubernetes version 1.21.11-0</li><li>Docker version 1.5.11-1</li></ul><h2 id=upgrade-process>Upgrade process</h2><p>Time taken: 1 hour.</p><h3 id=upgrade-first-master-node>Upgrade first master node</h3><ol><li>Upgrade kubeadm to 1.21.11-0</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>apt</span><span class=o>-</span><span class=nx>get</span> <span class=nx>update</span> <span class=o>&amp;&amp;</span> <span class=nx>apt</span><span class=o>-</span><span class=nx>get</span> <span class=nx>install</span> <span class=o>-</span><span class=nx>y</span> <span class=nx>kubeadm</span><span class=p>=</span><span class=mf>1.21.11</span><span class=o>-</span><span class=mo>00</span> <span class=o>&amp;&amp;</span> <span class=nx>apt</span><span class=o>-</span><span class=nx>mark</span> <span class=nx>hold</span> <span class=nx>kubeadm</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>output</span>
</span></span><span class=line><span class=cl><span class=err>$</span> <span class=nx>apt</span><span class=o>-</span><span class=nx>mark</span> <span class=nx>unhold</span> <span class=nx>kubeadm</span>
</span></span><span class=line><span class=cl><span class=err>$</span> <span class=nx>apt</span><span class=o>-</span><span class=nx>get</span> <span class=nx>update</span> <span class=o>&amp;&amp;</span> <span class=nx>apt</span><span class=o>-</span><span class=nx>get</span> <span class=nx>install</span> <span class=o>-</span><span class=nx>y</span> <span class=nx>kubeadm</span><span class=p>=</span><span class=mf>1.21.11</span><span class=o>-</span><span class=mo>00</span> <span class=o>&amp;&amp;</span> <span class=nx>apt</span><span class=o>-</span><span class=nx>mark</span> <span class=nx>hold</span> <span class=nx>kubeadm</span>
</span></span><span class=line><span class=cl><span class=nx>Hit</span><span class=p>:</span><span class=mi>1</span> <span class=nx>https</span><span class=p>:</span><span class=c1>//download.docker.com/linux/ubuntu focal InRelease
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Hit</span><span class=p>:</span><span class=mi>3</span> <span class=nx>http</span><span class=p>:</span><span class=c1>//ports.ubuntu.com/ubuntu-ports focal InRelease                       
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Hit</span><span class=p>:</span><span class=mi>2</span> <span class=nx>https</span><span class=p>:</span><span class=c1>//packages.cloud.google.com/apt kubernetes-xenial InRelease          
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Hit</span><span class=p>:</span><span class=mi>4</span> <span class=nx>http</span><span class=p>:</span><span class=c1>//ports.ubuntu.com/ubuntu-ports focal-updates InRelease
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Hit</span><span class=p>:</span><span class=mi>5</span> <span class=nx>http</span><span class=p>:</span><span class=c1>//ports.ubuntu.com/ubuntu-ports focal-backports InRelease
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Hit</span><span class=p>:</span><span class=mi>6</span> <span class=nx>http</span><span class=p>:</span><span class=c1>//ports.ubuntu.com/ubuntu-ports focal-security InRelease
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Reading</span> <span class=kn>package</span> <span class=nx>lists</span><span class=o>...</span> <span class=nx>Done</span>
</span></span><span class=line><span class=cl><span class=nx>Reading</span> <span class=kn>package</span> <span class=nx>lists</span><span class=o>...</span> <span class=nx>Done</span>
</span></span><span class=line><span class=cl><span class=nx>Building</span> <span class=nx>dependency</span> <span class=nx>tree</span>       
</span></span><span class=line><span class=cl><span class=nx>Reading</span> <span class=nx>state</span> <span class=nx>information</span><span class=o>...</span> <span class=nx>Done</span>
</span></span><span class=line><span class=cl><span class=nx>The</span> <span class=nx>following</span> <span class=nx>packages</span> <span class=nx>were</span> <span class=nx>automatically</span> <span class=nx>installed</span> <span class=nx>and</span> <span class=nx>are</span> <span class=nx>no</span> <span class=nx>longer</span> <span class=nx>required</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=err>…</span> <span class=nx>Use</span> <span class=err>&#39;</span><span class=nx>sudo</span> <span class=nx>apt</span> <span class=nx>autoremove</span><span class=err>&#39;</span> <span class=nx>to</span> <span class=nx>remove</span> <span class=nx>them</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>The</span> <span class=nx>following</span> <span class=nx>packages</span> <span class=nx>will</span> <span class=nx>be</span> <span class=nx>upgraded</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=nx>kubeadm</span>
</span></span><span class=line><span class=cl><span class=mi>1</span> <span class=nx>upgraded</span><span class=p>,</span> <span class=mi>0</span> <span class=nx>newly</span> <span class=nx>installed</span><span class=p>,</span> <span class=mi>0</span> <span class=nx>to</span> <span class=nx>remove</span> <span class=nx>and</span> <span class=mi>4</span> <span class=nx>not</span> <span class=nx>upgraded</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>Need</span> <span class=nx>to</span> <span class=nx>get</span> <span class=mi>7303</span> <span class=nx>kB</span> <span class=nx>of</span> <span class=nx>archives</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>After</span> <span class=nx>this</span> <span class=nx>operation</span><span class=p>,</span> <span class=mi>5308</span> <span class=nx>kB</span> <span class=nx>of</span> <span class=nx>additional</span> <span class=nx>disk</span> <span class=nx>space</span> <span class=nx>will</span> <span class=nx>be</span> <span class=nx>used</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>Get</span><span class=p>:</span><span class=mi>1</span> <span class=nx>https</span><span class=p>:</span><span class=c1>//packages.cloud.google.com/apt kubernetes-xenial/main arm64 kubeadm arm64 1.21.11-00 [7303 kB]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Fetched</span> <span class=mi>7303</span> <span class=nx>kB</span> <span class=nx>in</span> <span class=mi>1</span><span class=nf>s</span> <span class=p>(</span><span class=mi>4933</span> <span class=nx>kB</span><span class=o>/</span><span class=nx>s</span><span class=p>)</span>  
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nx>Reading</span> <span class=nx>database</span> <span class=o>...</span> <span class=mi>150653</span> <span class=nx>files</span> <span class=nx>and</span> <span class=nx>directories</span> <span class=nx>currently</span> <span class=nx>installed</span><span class=p>.)</span>
</span></span><span class=line><span class=cl><span class=nx>Preparing</span> <span class=nx>to</span> <span class=nx>unpack</span> <span class=o>.../</span><span class=nx>kubeadm_1</span><span class=mf>.21.11</span><span class=o>-</span><span class=mo>00</span><span class=nx>_arm64</span><span class=p>.</span><span class=nx>deb</span> <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>Unpacking</span> <span class=nf>kubeadm</span> <span class=p>(</span><span class=mf>1.21.11</span><span class=o>-</span><span class=mo>00</span><span class=p>)</span> <span class=nf>over</span> <span class=p>(</span><span class=mf>1.20.5</span><span class=o>-</span><span class=mo>00</span><span class=p>)</span> <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>Setting</span> <span class=nx>up</span> <span class=nf>kubeadm</span> <span class=p>(</span><span class=mf>1.21.11</span><span class=o>-</span><span class=mo>00</span><span class=p>)</span> <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>kubeadm</span> <span class=nx>set</span> <span class=nx>on</span> <span class=nx>hold</span><span class=p>.</span>
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>Derive update plan</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubeadm upgrade plan
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># output
</span></span><span class=line><span class=cl>[upgrade/config] Making sure the configuration is correct:
</span></span><span class=line><span class=cl>[upgrade/config] Reading configuration from the cluster...
</span></span><span class=line><span class=cl>[upgrade/config] FYI: You can look at this config file with &#39;kubectl -n kube-system get cm kubeadm-config -o yaml&#39;
</span></span><span class=line><span class=cl>[preflight] Running pre-flight checks.
</span></span><span class=line><span class=cl>[upgrade] Running cluster health checks
</span></span><span class=line><span class=cl>[upgrade] Fetching available versions to upgrade to
</span></span><span class=line><span class=cl>[upgrade/versions] Cluster version: v1.20.0
</span></span><span class=line><span class=cl>[upgrade/versions] kubeadm version: v1.21.11
</span></span><span class=line><span class=cl>I0410 14:21:06.582792    7078 version.go:254] remote version is much newer: v1.23.5; falling back to: stable-1.21
</span></span><span class=line><span class=cl>[upgrade/versions] Target version: v1.21.11
</span></span><span class=line><span class=cl>[upgrade/versions] Latest version in the v1.20 series: v1.20.15
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Components that must be upgraded manually after you have upgraded the control plane with &#39;kubeadm upgrade apply&#39;:
</span></span><span class=line><span class=cl>COMPONENT   CURRENT       TARGET
</span></span><span class=line><span class=cl>kubelet     4 x v1.20.5   v1.20.15
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Upgrade to the latest version in the v1.20 series:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>COMPONENT                 CURRENT    TARGET
</span></span><span class=line><span class=cl>kube-apiserver            v1.20.0    v1.20.15
</span></span><span class=line><span class=cl>kube-controller-manager   v1.20.0    v1.20.15
</span></span><span class=line><span class=cl>kube-scheduler            v1.20.0    v1.20.15
</span></span><span class=line><span class=cl>kube-proxy                v1.20.0    v1.20.15
</span></span><span class=line><span class=cl>CoreDNS                   1.7.0      v1.8.0
</span></span><span class=line><span class=cl>etcd                      3.4.13-0   3.4.13-0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>You can now apply the upgrade by executing the following command:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	kubeadm upgrade apply v1.20.15
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>_____________________________________________________________________
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Components that must be upgraded manually after you have upgraded the control plane with &#39;kubeadm upgrade apply&#39;:
</span></span><span class=line><span class=cl>COMPONENT   CURRENT       TARGET
</span></span><span class=line><span class=cl>kubelet     4 x v1.20.5   v1.21.11
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Upgrade to the latest stable version:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>COMPONENT                 CURRENT    TARGET
</span></span><span class=line><span class=cl>kube-apiserver            v1.20.0    v1.21.11
</span></span><span class=line><span class=cl>kube-controller-manager   v1.20.0    v1.21.11
</span></span><span class=line><span class=cl>kube-scheduler            v1.20.0    v1.21.11
</span></span><span class=line><span class=cl>kube-proxy                v1.20.0    v1.21.11
</span></span><span class=line><span class=cl>CoreDNS                   1.7.0      v1.8.0
</span></span><span class=line><span class=cl>etcd                      3.4.13-0   3.4.13-0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>You can now apply the upgrade by executing the following command:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	kubeadm upgrade apply v1.21.11
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>_____________________________________________________________________
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>The table below shows the current state of component configs as understood by this version of kubeadm.
</span></span><span class=line><span class=cl>Configs that have a &#34;yes&#34; mark in the &#34;MANUAL UPGRADE REQUIRED&#34; column require manual config upgrade or
</span></span><span class=line><span class=cl>resetting to kubeadm defaults before a successful upgrade can be performed. The version to manually
</span></span><span class=line><span class=cl>upgrade to is denoted in the &#34;PREFERRED VERSION&#34; column.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>API GROUP                 CURRENT VERSION   PREFERRED VERSION   MANUAL UPGRADE REQUIRED
</span></span><span class=line><span class=cl>kubeproxy.config.k8s.io   v1alpha1          v1alpha1            no
</span></span><span class=line><span class=cl>kubelet.config.k8s.io     v1beta1           v1beta1             no
</span></span><span class=line><span class=cl>_____________________________________________________________________
</span></span></code></pre></td></tr></table></div></div><ol start=3><li>Apply update plan 1.21.11 to the first node</li></ol><p>Did take some time to fetch docker image from web.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubeadm upgrade apply v1.21.11
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#output
</span></span><span class=line><span class=cl>[upgrade/config] Making sure the configuration is correct:
</span></span><span class=line><span class=cl>[upgrade/config] Reading configuration from the cluster...
</span></span><span class=line><span class=cl>[upgrade/config] FYI: You can look at this config file with &#39;kubectl -n kube-system get cm kubeadm-config -o yaml&#39;
</span></span><span class=line><span class=cl>[preflight] Running pre-flight checks.
</span></span><span class=line><span class=cl>[upgrade] Running cluster health checks
</span></span><span class=line><span class=cl>[upgrade/version] You have chosen to change the cluster version to &#34;v1.21.11&#34;
</span></span><span class=line><span class=cl>[upgrade/versions] Cluster version: v1.20.0
</span></span><span class=line><span class=cl>[upgrade/versions] kubeadm version: v1.21.11
</span></span><span class=line><span class=cl>[upgrade/confirm] Are you sure you want to proceed with the upgrade? [y/N]: y 
</span></span><span class=line><span class=cl>[upgrade/prepull] Pulling images required for setting up a Kubernetes cluster
</span></span><span class=line><span class=cl>[upgrade/prepull] This might take a minute or two, depending on the speed of your internet connection
</span></span><span class=line><span class=cl>[upgrade/prepull] You can also perform this action in beforehand using &#39;kubeadm config images pull&#39;
</span></span><span class=line><span class=cl>[upgrade/apply] Upgrading your Static Pod-hosted control plane to version &#34;v1.21.11&#34;...
</span></span><span class=line><span class=cl>Static pod: kube-apiserver-k8s-master01 hash: 5fde095b33443ffc5b8cf050db39cf4b
</span></span><span class=line><span class=cl>Static pod: kube-controller-manager-k8s-master01 hash: 14bd5e3b420dd28be544748ab422fb6a
</span></span><span class=line><span class=cl>Static pod: kube-scheduler-k8s-master01 hash: 81d2d21449d64d5e6d5e9069a7ca99ed
</span></span><span class=line><span class=cl>[upgrade/etcd] Upgrading to TLS for etcd
</span></span><span class=line><span class=cl>Static pod: etcd-k8s-master01 hash: 7bcedb4b737338eb6a1b2b77e74c4ed9
</span></span><span class=line><span class=cl>[upgrade/staticpods] Preparing for &#34;etcd&#34; upgrade
</span></span><span class=line><span class=cl>[upgrade/staticpods] Renewing etcd-server certificate
</span></span><span class=line><span class=cl>[upgrade/staticpods] Renewing etcd-peer certificate
</span></span><span class=line><span class=cl>[upgrade/staticpods] Renewing etcd-healthcheck-client certificate
</span></span><span class=line><span class=cl>[upgrade/staticpods] Moved new manifest to &#34;/etc/kubernetes/manifests/etcd.yaml&#34; and backed up old manifest to &#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2022-04-10-14-28-50/etcd.yaml&#34;
</span></span><span class=line><span class=cl>[upgrade/staticpods] Waiting for the kubelet to restart the component
</span></span><span class=line><span class=cl>[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)
</span></span><span class=line><span class=cl>Static pod: etcd-k8s-master01 hash: 7bcedb4b737338eb6a1b2b77e74c4ed9
</span></span><span class=line><span class=cl>…Static pod: etcd-k8s-master01 hash: cc00f6511d31760c7ffa84ade5d22764
</span></span><span class=line><span class=cl>[apiclient] Found 3 Pods for label selector component=etcd
</span></span><span class=line><span class=cl>[upgrade/staticpods] Component &#34;etcd&#34; upgraded successfully!
</span></span><span class=line><span class=cl>[upgrade/etcd] Waiting for etcd to become available
</span></span><span class=line><span class=cl>[upgrade/staticpods] Writing new Static Pod manifests to &#34;/etc/kubernetes/tmp/kubeadm-upgraded-manifests641878118&#34;
</span></span><span class=line><span class=cl>[upgrade/staticpods] Preparing for &#34;kube-apiserver&#34; upgrade
</span></span><span class=line><span class=cl>[upgrade/staticpods] Renewing apiserver certificate
</span></span><span class=line><span class=cl>[upgrade/staticpods] Renewing apiserver-kubelet-client certificate
</span></span><span class=line><span class=cl>[upgrade/staticpods] Renewing front-proxy-client certificate
</span></span><span class=line><span class=cl>[upgrade/staticpods] Renewing apiserver-etcd-client certificate
</span></span><span class=line><span class=cl>[upgrade/staticpods] Moved new manifest to &#34;/etc/kubernetes/manifests/kube-apiserver.yaml&#34; and backed up old manifest to &#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2022-04-10-14-28-50/kube-apiserver.yaml&#34;
</span></span><span class=line><span class=cl>[upgrade/staticpods] Waiting for the kubelet to restart the component
</span></span><span class=line><span class=cl>[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)
</span></span><span class=line><span class=cl>Static pod: kube-apiserver-k8s-master01 hash: 5fde095b33443ffc5b8cf050db39cf4b
</span></span><span class=line><span class=cl>…
</span></span><span class=line><span class=cl>Static pod: kube-apiserver-k8s-master01 hash: a940072fa30c12aeebd1efe6dfcdcc1c
</span></span><span class=line><span class=cl>[apiclient] Found 3 Pods for label selector component=kube-apiserver
</span></span><span class=line><span class=cl>[upgrade/staticpods] Component &#34;kube-apiserver&#34; upgraded successfully!
</span></span><span class=line><span class=cl>[upgrade/staticpods] Preparing for &#34;kube-controller-manager&#34; upgrade
</span></span><span class=line><span class=cl>[upgrade/staticpods] Renewing controller-manager.conf certificate
</span></span><span class=line><span class=cl>[upgrade/staticpods] Moved new manifest to &#34;/etc/kubernetes/manifests/kube-controller-manager.yaml&#34; and backed up old manifest to &#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2022-04-10-14-28-50/kube-controller-manager.yaml&#34;
</span></span><span class=line><span class=cl>[upgrade/staticpods] Waiting for the kubelet to restart the component
</span></span><span class=line><span class=cl>[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)
</span></span><span class=line><span class=cl>Static pod: kube-controller-manager-k8s-master01 hash: 14bd5e3b420dd28be544748ab422fb6a
</span></span><span class=line><span class=cl>[apiclient] Found 3 Pods for label selector component=kube-controller-manager
</span></span><span class=line><span class=cl>[upgrade/staticpods] Component &#34;kube-controller-manager&#34; upgraded successfully!
</span></span><span class=line><span class=cl>[upgrade/staticpods] Preparing for &#34;kube-scheduler&#34; upgrade
</span></span><span class=line><span class=cl>[upgrade/staticpods] Renewing scheduler.conf certificate
</span></span><span class=line><span class=cl>[upgrade/staticpods] Moved new manifest to &#34;/etc/kubernetes/manifests/kube-scheduler.yaml&#34; and backed up old manifest to &#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2022-04-10-14-28-50/kube-scheduler.yaml&#34;
</span></span><span class=line><span class=cl>[upgrade/staticpods] Waiting for the kubelet to restart the component
</span></span><span class=line><span class=cl>[upgrade/staticpods] This might take a minute or longer depending on the component/version gap (timeout 5m0s)
</span></span><span class=line><span class=cl>Static pod: kube-scheduler-k8s-master01 hash: 81d2d21449d64d5e6d5e9069a7ca99ed
</span></span><span class=line><span class=cl>…
</span></span><span class=line><span class=cl>Static pod: kube-scheduler-k8s-master01 hash: 93632060532583bc6e1b6f38dd64f10e
</span></span><span class=line><span class=cl>[apiclient] Found 3 Pods for label selector component=kube-scheduler
</span></span><span class=line><span class=cl>[upgrade/staticpods] Component &#34;kube-scheduler&#34; upgraded successfully!
</span></span><span class=line><span class=cl>[upgrade/postupgrade] Applying label node-role.kubernetes.io/control-plane=&#39;&#39; to Nodes with label node-role.kubernetes.io/master=&#39;&#39; (deprecated)
</span></span><span class=line><span class=cl>[upgrade/postupgrade] Applying label node.kubernetes.io/exclude-from-external-load-balancers=&#39;&#39; to control plane Nodes
</span></span><span class=line><span class=cl>[upload-config] Storing the configuration used in ConfigMap &#34;kubeadm-config&#34; in the &#34;kube-system&#34; Namespace
</span></span><span class=line><span class=cl>[kubelet] Creating a ConfigMap &#34;kubelet-config-1.21&#34; in namespace kube-system with the configuration for the kubelets in the cluster
</span></span><span class=line><span class=cl>[kubelet-start] Writing kubelet configuration to file &#34;/var/lib/kubelet/config.yaml&#34;
</span></span><span class=line><span class=cl>[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes
</span></span><span class=line><span class=cl>[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
</span></span><span class=line><span class=cl>[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
</span></span><span class=line><span class=cl>[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
</span></span><span class=line><span class=cl>[addons] Applied essential addon: CoreDNS
</span></span><span class=line><span class=cl>[endpoint] WARNING: port specified in controlPlaneEndpoint overrides bindPort in the controlplane address
</span></span><span class=line><span class=cl>[addons] Applied essential addon: kube-proxy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[upgrade/successful] SUCCESS! Your cluster was upgraded to &#34;v1.21.11&#34;. Enjoy!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[upgrade/kubelet] Now that your control plane is upgraded, please proceed with upgrading your kubelets if you haven&#39;t already done so.
</span></span></code></pre></td></tr></table></div></div><ol start=4><li>Update kubelet on the first master node</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>apt</span><span class=o>-</span><span class=nx>mark</span> <span class=nx>unhold</span> <span class=nx>kubelet</span> <span class=o>&amp;&amp;</span> <span class=nx>apt</span><span class=o>-</span><span class=nx>get</span> <span class=nx>update</span> <span class=o>&amp;&amp;</span> <span class=nx>apt</span><span class=o>-</span><span class=nx>get</span> <span class=nx>install</span> <span class=o>-</span><span class=nx>y</span> <span class=nx>kubelet</span><span class=p>=</span><span class=mf>1.21.11</span><span class=o>-</span><span class=mo>00</span> <span class=o>&amp;&amp;</span> <span class=nx>apt</span><span class=o>-</span><span class=nx>mark</span> <span class=nx>hold</span> <span class=nx>kubelet</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=nx>output</span>
</span></span><span class=line><span class=cl><span class=nx>Canceled</span> <span class=nx>hold</span> <span class=nx>on</span> <span class=nx>kubelet</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>Hit</span><span class=p>:</span><span class=mi>1</span> <span class=nx>https</span><span class=p>:</span><span class=c1>//download.docker.com/linux/ubuntu focal InRelease
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Hit</span><span class=p>:</span><span class=mi>3</span> <span class=nx>http</span><span class=p>:</span><span class=c1>//ports.ubuntu.com/ubuntu-ports focal InRelease                
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Hit</span><span class=p>:</span><span class=mi>2</span> <span class=nx>https</span><span class=p>:</span><span class=c1>//packages.cloud.google.com/apt kubernetes-xenial InRelease
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Get</span><span class=p>:</span><span class=mi>4</span> <span class=nx>http</span><span class=p>:</span><span class=c1>//ports.ubuntu.com/ubuntu-ports focal-updates InRelease [114 kB]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Get</span><span class=p>:</span><span class=mi>5</span> <span class=nx>http</span><span class=p>:</span><span class=c1>//ports.ubuntu.com/ubuntu-ports focal-backports InRelease [108 kB]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Get</span><span class=p>:</span><span class=mi>6</span> <span class=nx>http</span><span class=p>:</span><span class=c1>//ports.ubuntu.com/ubuntu-ports focal-security InRelease [114 kB]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Fetched</span> <span class=mi>336</span> <span class=nx>kB</span> <span class=nx>in</span> <span class=mi>2</span><span class=nf>s</span> <span class=p>(</span><span class=mi>146</span> <span class=nx>kB</span><span class=o>/</span><span class=nx>s</span><span class=p>)</span>  
</span></span><span class=line><span class=cl><span class=nx>Reading</span> <span class=kn>package</span> <span class=nx>lists</span><span class=o>...</span> <span class=nx>Done</span>
</span></span><span class=line><span class=cl><span class=nx>Reading</span> <span class=kn>package</span> <span class=nx>lists</span><span class=o>...</span> <span class=nx>Done</span>
</span></span><span class=line><span class=cl><span class=nx>Building</span> <span class=nx>dependency</span> <span class=nx>tree</span>       
</span></span><span class=line><span class=cl><span class=nx>Reading</span> <span class=nx>state</span> <span class=nx>information</span><span class=o>...</span> <span class=nx>Done</span>
</span></span><span class=line><span class=cl><span class=nx>The</span> <span class=nx>following</span> <span class=nx>packages</span> <span class=nx>will</span> <span class=nx>be</span> <span class=nx>upgraded</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=nx>kubelet</span>
</span></span><span class=line><span class=cl><span class=mi>1</span> <span class=nx>upgraded</span><span class=p>,</span> <span class=mi>0</span> <span class=nx>newly</span> <span class=nx>installed</span><span class=p>,</span> <span class=mi>0</span> <span class=nx>to</span> <span class=nx>remove</span> <span class=nx>and</span> <span class=mi>4</span> <span class=nx>not</span> <span class=nx>upgraded</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>Need</span> <span class=nx>to</span> <span class=nx>get</span> <span class=mf>16.4</span> <span class=nx>MB</span> <span class=nx>of</span> <span class=nx>archives</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>After</span> <span class=nx>this</span> <span class=nx>operation</span><span class=p>,</span> <span class=mi>4346</span> <span class=nx>kB</span> <span class=nx>of</span> <span class=nx>additional</span> <span class=nx>disk</span> <span class=nx>space</span> <span class=nx>will</span> <span class=nx>be</span> <span class=nx>used</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>Get</span><span class=p>:</span><span class=mi>1</span> <span class=nx>https</span><span class=p>:</span><span class=c1>//packages.cloud.google.com/apt kubernetes-xenial/main arm64 kubelet arm64 1.21.11-00 [16.4 MB]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Fetched</span> <span class=mf>16.4</span> <span class=nx>MB</span> <span class=nx>in</span> <span class=mi>3</span><span class=nf>s</span> <span class=p>(</span><span class=mi>6562</span> <span class=nx>kB</span><span class=o>/</span><span class=nx>s</span><span class=p>)</span>  
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nx>Reading</span> <span class=nx>database</span> <span class=o>...</span> <span class=mi>133897</span> <span class=nx>files</span> <span class=nx>and</span> <span class=nx>directories</span> <span class=nx>currently</span> <span class=nx>installed</span><span class=p>.)</span>
</span></span><span class=line><span class=cl><span class=nx>Preparing</span> <span class=nx>to</span> <span class=nx>unpack</span> <span class=o>.../</span><span class=nx>kubelet_1</span><span class=mf>.21.11</span><span class=o>-</span><span class=mo>00</span><span class=nx>_arm64</span><span class=p>.</span><span class=nx>deb</span> <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>Unpacking</span> <span class=nf>kubelet</span> <span class=p>(</span><span class=mf>1.21.11</span><span class=o>-</span><span class=mo>00</span><span class=p>)</span> <span class=nf>over</span> <span class=p>(</span><span class=mf>1.20.5</span><span class=o>-</span><span class=mo>00</span><span class=p>)</span> <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>Setting</span> <span class=nx>up</span> <span class=nf>kubelet</span> <span class=p>(</span><span class=mf>1.21.11</span><span class=o>-</span><span class=mo>00</span><span class=p>)</span> <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>kubelet</span> <span class=nx>set</span> <span class=nx>on</span> <span class=nx>hold</span><span class=p>.</span>
</span></span></code></pre></td></tr></table></div></div><ol start=5><li>Restart kubelet</li></ol><p><code>systemctl restart kubelet</code></p><p>Now when you run <code>kubectl get nodes</code>, you should see only 1 master node with v1.21.11</p><h3 id=upgrade-other-master-nodes>Upgrade other master nodes</h3><p>Repeat step 6-8 on other master nodes</p><ol start=6><li>Update kubeadm on other master nodes</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>apt</span><span class=o>-</span><span class=nx>mark</span> <span class=nx>unhold</span> <span class=nx>kubeadm</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl><span class=nx>apt</span><span class=o>-</span><span class=nx>get</span> <span class=nx>update</span> <span class=o>&amp;&amp;</span> <span class=nx>apt</span><span class=o>-</span><span class=nx>get</span> <span class=nx>install</span> <span class=o>-</span><span class=nx>y</span> <span class=nx>kubeadm</span><span class=p>=</span><span class=mf>1.21.11</span><span class=o>-</span><span class=mo>00</span> <span class=o>&amp;&amp;</span> <span class=nx>apt</span><span class=o>-</span><span class=nx>mark</span> <span class=nx>hold</span> <span class=nx>kubeadm</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=nx>output</span>
</span></span><span class=line><span class=cl><span class=nx>Canceled</span> <span class=nx>hold</span> <span class=nx>on</span> <span class=nx>kubeadm</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>Hit</span><span class=p>:</span><span class=mi>1</span> <span class=nx>https</span><span class=p>:</span><span class=c1>//download.docker.com/linux/ubuntu focal InRelease
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Hit</span><span class=p>:</span><span class=mi>3</span> <span class=nx>http</span><span class=p>:</span><span class=c1>//ports.ubuntu.com/ubuntu-ports focal InRelease                       
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Hit</span><span class=p>:</span><span class=mi>2</span> <span class=nx>https</span><span class=p>:</span><span class=c1>//packages.cloud.google.com/apt kubernetes-xenial InRelease          
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Get</span><span class=p>:</span><span class=mi>4</span> <span class=nx>http</span><span class=p>:</span><span class=c1>//ports.ubuntu.com/ubuntu-ports focal-updates InRelease [114 kB]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Get</span><span class=p>:</span><span class=mi>5</span> <span class=nx>http</span><span class=p>:</span><span class=c1>//ports.ubuntu.com/ubuntu-ports focal-backports InRelease [108 kB]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Get</span><span class=p>:</span><span class=mi>6</span> <span class=nx>http</span><span class=p>:</span><span class=c1>//ports.ubuntu.com/ubuntu-ports focal-security InRelease [114 kB]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Get</span><span class=p>:</span><span class=mi>7</span> <span class=nx>http</span><span class=p>:</span><span class=c1>//ports.ubuntu.com/ubuntu-ports focal-updates/main arm64 Packages [1177 kB]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Get</span><span class=p>:</span><span class=mi>8</span> <span class=nx>http</span><span class=p>:</span><span class=c1>//ports.ubuntu.com/ubuntu-ports focal-updates/universe arm64 Packages [863 kB]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Fetched</span> <span class=mi>2376</span> <span class=nx>kB</span> <span class=nx>in</span> <span class=mi>3</span><span class=nf>s</span> <span class=p>(</span><span class=mi>682</span> <span class=nx>kB</span><span class=o>/</span><span class=nx>s</span><span class=p>)</span>                         
</span></span><span class=line><span class=cl><span class=nx>Reading</span> <span class=kn>package</span> <span class=nx>lists</span><span class=o>...</span> <span class=nx>Done</span>
</span></span><span class=line><span class=cl><span class=nx>Reading</span> <span class=kn>package</span> <span class=nx>lists</span><span class=o>...</span> <span class=nx>Done</span>
</span></span><span class=line><span class=cl><span class=nx>Building</span> <span class=nx>dependency</span> <span class=nx>tree</span>       
</span></span><span class=line><span class=cl><span class=nx>Reading</span> <span class=nx>state</span> <span class=nx>information</span><span class=o>...</span> <span class=nx>Done</span>
</span></span><span class=line><span class=cl><span class=nx>The</span> <span class=nx>following</span> <span class=nx>packages</span> <span class=nx>were</span> <span class=nx>automatically</span> <span class=nx>installed</span> <span class=nx>and</span> <span class=nx>are</span> <span class=nx>no</span> <span class=nx>longer</span> <span class=nx>required</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=err>…</span>
</span></span><span class=line><span class=cl><span class=nx>Use</span> <span class=err>&#39;</span><span class=nx>sudo</span> <span class=nx>apt</span> <span class=nx>autoremove</span><span class=err>&#39;</span> <span class=nx>to</span> <span class=nx>remove</span> <span class=nx>them</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>The</span> <span class=nx>following</span> <span class=nx>packages</span> <span class=nx>will</span> <span class=nx>be</span> <span class=nx>upgraded</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=nx>kubeadm</span>
</span></span><span class=line><span class=cl><span class=mi>1</span> <span class=nx>upgraded</span><span class=p>,</span> <span class=mi>0</span> <span class=nx>newly</span> <span class=nx>installed</span><span class=p>,</span> <span class=mi>0</span> <span class=nx>to</span> <span class=nx>remove</span> <span class=nx>and</span> <span class=mi>4</span> <span class=nx>not</span> <span class=nx>upgraded</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>Need</span> <span class=nx>to</span> <span class=nx>get</span> <span class=mi>7303</span> <span class=nx>kB</span> <span class=nx>of</span> <span class=nx>archives</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>After</span> <span class=nx>this</span> <span class=nx>operation</span><span class=p>,</span> <span class=mi>5308</span> <span class=nx>kB</span> <span class=nx>of</span> <span class=nx>additional</span> <span class=nx>disk</span> <span class=nx>space</span> <span class=nx>will</span> <span class=nx>be</span> <span class=nx>used</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>Get</span><span class=p>:</span><span class=mi>1</span> <span class=nx>https</span><span class=p>:</span><span class=c1>//packages.cloud.google.com/apt kubernetes-xenial/main arm64 kubeadm arm64 1.21.11-00 [7303 kB]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Fetched</span> <span class=mi>7303</span> <span class=nx>kB</span> <span class=nx>in</span> <span class=mi>1</span><span class=nf>s</span> <span class=p>(</span><span class=mi>8953</span> <span class=nx>kB</span><span class=o>/</span><span class=nx>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nx>Reading</span> <span class=nx>database</span> <span class=o>...</span> <span class=mi>150581</span> <span class=nx>files</span> <span class=nx>and</span> <span class=nx>directories</span> <span class=nx>currently</span> <span class=nx>installed</span><span class=p>.)</span>
</span></span><span class=line><span class=cl><span class=nx>Preparing</span> <span class=nx>to</span> <span class=nx>unpack</span> <span class=o>.../</span><span class=nx>kubeadm_1</span><span class=mf>.21.11</span><span class=o>-</span><span class=mo>00</span><span class=nx>_arm64</span><span class=p>.</span><span class=nx>deb</span> <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>Unpacking</span> <span class=nf>kubeadm</span> <span class=p>(</span><span class=mf>1.21.11</span><span class=o>-</span><span class=mo>00</span><span class=p>)</span> <span class=nf>over</span> <span class=p>(</span><span class=mf>1.20.5</span><span class=o>-</span><span class=mo>00</span><span class=p>)</span> <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>Setting</span> <span class=nx>up</span> <span class=nf>kubeadm</span> <span class=p>(</span><span class=mf>1.21.11</span><span class=o>-</span><span class=mo>00</span><span class=p>)</span> <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>kubeadm</span> <span class=nx>set</span> <span class=nx>on</span> <span class=nx>hold</span><span class=p>.</span>
</span></span></code></pre></td></tr></table></div></div><ol start=7><li>Apply update plan</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>kubeadm</span> <span class=nx>upgrade</span> <span class=nx>node</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=nx>output</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=p>]</span> <span class=nx>Reading</span> <span class=nx>configuration</span> <span class=nx>from</span> <span class=nx>the</span> <span class=nx>cluster</span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=p>]</span> <span class=nx>FYI</span><span class=p>:</span> <span class=nx>You</span> <span class=nx>can</span> <span class=nx>look</span> <span class=nx>at</span> <span class=nx>this</span> <span class=nx>config</span> <span class=nx>file</span> <span class=nx>with</span> <span class=err>&#39;</span><span class=nx>kubectl</span> <span class=o>-</span><span class=nx>n</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>system</span> <span class=nx>get</span> <span class=nx>cm</span> <span class=nx>kubeadm</span><span class=o>-</span><span class=nx>config</span> <span class=o>-</span><span class=nx>o</span> <span class=nx>yaml</span><span class=err>&#39;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>preflight</span><span class=p>]</span> <span class=nx>Running</span> <span class=nx>pre</span><span class=o>-</span><span class=nx>flight</span> <span class=nx>checks</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>preflight</span><span class=p>]</span> <span class=nx>Pulling</span> <span class=nx>images</span> <span class=nx>required</span> <span class=k>for</span> <span class=nx>setting</span> <span class=nx>up</span> <span class=nx>a</span> <span class=nx>Kubernetes</span> <span class=nx>cluster</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>preflight</span><span class=p>]</span> <span class=nx>This</span> <span class=nx>might</span> <span class=nx>take</span> <span class=nx>a</span> <span class=nx>minute</span> <span class=nx>or</span> <span class=nx>two</span><span class=p>,</span> <span class=nx>depending</span> <span class=nx>on</span> <span class=nx>the</span> <span class=nx>speed</span> <span class=nx>of</span> <span class=nx>your</span> <span class=nx>internet</span> <span class=nx>connection</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>preflight</span><span class=p>]</span> <span class=nx>You</span> <span class=nx>can</span> <span class=nx>also</span> <span class=nx>perform</span> <span class=nx>this</span> <span class=nx>action</span> <span class=nx>in</span> <span class=nx>beforehand</span> <span class=nx>using</span> <span class=err>&#39;</span><span class=nx>kubeadm</span> <span class=nx>config</span> <span class=nx>images</span> <span class=nx>pull</span><span class=err>&#39;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=p>]</span> <span class=nx>Upgrading</span> <span class=nx>your</span> <span class=nx>Static</span> <span class=nx>Pod</span><span class=o>-</span><span class=nx>hosted</span> <span class=nx>control</span> <span class=nx>plane</span> <span class=nx>instance</span> <span class=nx>to</span> <span class=nx>version</span> <span class=s>&#34;v1.21.11&#34;</span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=nx>Static</span> <span class=nx>pod</span><span class=p>:</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>apiserver</span><span class=o>-</span><span class=nx>k8s</span><span class=o>-</span><span class=nx>master02</span> <span class=nx>hash</span><span class=p>:</span> <span class=nx>bbdf76d8ed7bbfbefa3eb630aa51b714</span>
</span></span><span class=line><span class=cl><span class=nx>Static</span> <span class=nx>pod</span><span class=p>:</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>controller</span><span class=o>-</span><span class=nx>manager</span><span class=o>-</span><span class=nx>k8s</span><span class=o>-</span><span class=nx>master02</span> <span class=nx>hash</span><span class=p>:</span> <span class=mi>96</span><span class=nx>d194097d7a0962788e7017657e9408</span>
</span></span><span class=line><span class=cl><span class=nx>Static</span> <span class=nx>pod</span><span class=p>:</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>scheduler</span><span class=o>-</span><span class=nx>k8s</span><span class=o>-</span><span class=nx>master02</span> <span class=nx>hash</span><span class=p>:</span> <span class=mi>81</span><span class=nx>d2d21449d64d5e6d5e9069a7ca99ed</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>etcd</span><span class=p>]</span> <span class=nx>Upgrading</span> <span class=nx>to</span> <span class=nx>TLS</span> <span class=k>for</span> <span class=nx>etcd</span>
</span></span><span class=line><span class=cl><span class=nx>Static</span> <span class=nx>pod</span><span class=p>:</span> <span class=nx>etcd</span><span class=o>-</span><span class=nx>k8s</span><span class=o>-</span><span class=nx>master02</span> <span class=nx>hash</span><span class=p>:</span> <span class=nx>dbba304816e4096538130e05d56ce432</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Preparing</span> <span class=k>for</span> <span class=s>&#34;etcd&#34;</span> <span class=nx>upgrade</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Renewing</span> <span class=nx>etcd</span><span class=o>-</span><span class=nx>server</span> <span class=nx>certificate</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Renewing</span> <span class=nx>etcd</span><span class=o>-</span><span class=nx>peer</span> <span class=nx>certificate</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Renewing</span> <span class=nx>etcd</span><span class=o>-</span><span class=nx>healthcheck</span><span class=o>-</span><span class=nx>client</span> <span class=nx>certificate</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Moved</span> <span class=nx>new</span> <span class=nx>manifest</span> <span class=nx>to</span> <span class=s>&#34;/etc/kubernetes/manifests/etcd.yaml&#34;</span> <span class=nx>and</span> <span class=nx>backed</span> <span class=nx>up</span> <span class=nx>old</span> <span class=nx>manifest</span> <span class=nx>to</span> <span class=s>&#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2022-04-10-14-38-44/etcd.yaml&#34;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Waiting</span> <span class=k>for</span> <span class=nx>the</span> <span class=nx>kubelet</span> <span class=nx>to</span> <span class=nx>restart</span> <span class=nx>the</span> <span class=nx>component</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>This</span> <span class=nx>might</span> <span class=nx>take</span> <span class=nx>a</span> <span class=nx>minute</span> <span class=nx>or</span> <span class=nx>longer</span> <span class=nx>depending</span> <span class=nx>on</span> <span class=nx>the</span> <span class=nx>component</span><span class=o>/</span><span class=nx>version</span> <span class=nf>gap</span> <span class=p>(</span><span class=nx>timeout</span> <span class=mi>5</span><span class=nx>m0s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>Static</span> <span class=nx>pod</span><span class=p>:</span> <span class=nx>etcd</span><span class=o>-</span><span class=nx>k8s</span><span class=o>-</span><span class=nx>master02</span> <span class=nx>hash</span><span class=p>:</span> <span class=nx>dbba304816e4096538130e05d56ce432</span>
</span></span><span class=line><span class=cl><span class=err>…</span><span class=nx>Static</span> <span class=nx>pod</span><span class=p>:</span> <span class=nx>etcd</span><span class=o>-</span><span class=nx>k8s</span><span class=o>-</span><span class=nx>master02</span> <span class=nx>hash</span><span class=p>:</span> <span class=mi>7</span><span class=nx>ad49516ae7d2e9bb37ae4548bac7ee7</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>apiclient</span><span class=p>]</span> <span class=nx>Found</span> <span class=mi>3</span> <span class=nx>Pods</span> <span class=k>for</span> <span class=nx>label</span> <span class=nx>selector</span> <span class=nx>component</span><span class=p>=</span><span class=nx>etcd</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Component</span> <span class=s>&#34;etcd&#34;</span> <span class=nx>upgraded</span> <span class=nx>successfully</span><span class=p>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>etcd</span><span class=p>]</span> <span class=nx>Waiting</span> <span class=k>for</span> <span class=nx>etcd</span> <span class=nx>to</span> <span class=nx>become</span> <span class=nx>available</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Writing</span> <span class=nx>new</span> <span class=nx>Static</span> <span class=nx>Pod</span> <span class=nx>manifests</span> <span class=nx>to</span> <span class=s>&#34;/etc/kubernetes/tmp/kubeadm-upgraded-manifests617011125&#34;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Preparing</span> <span class=k>for</span> <span class=s>&#34;kube-apiserver&#34;</span> <span class=nx>upgrade</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Renewing</span> <span class=nx>apiserver</span> <span class=nx>certificate</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Renewing</span> <span class=nx>apiserver</span><span class=o>-</span><span class=nx>kubelet</span><span class=o>-</span><span class=nx>client</span> <span class=nx>certificate</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Renewing</span> <span class=nx>front</span><span class=o>-</span><span class=nx>proxy</span><span class=o>-</span><span class=nx>client</span> <span class=nx>certificate</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Renewing</span> <span class=nx>apiserver</span><span class=o>-</span><span class=nx>etcd</span><span class=o>-</span><span class=nx>client</span> <span class=nx>certificate</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Moved</span> <span class=nx>new</span> <span class=nx>manifest</span> <span class=nx>to</span> <span class=s>&#34;/etc/kubernetes/manifests/kube-apiserver.yaml&#34;</span> <span class=nx>and</span> <span class=nx>backed</span> <span class=nx>up</span> <span class=nx>old</span> <span class=nx>manifest</span> <span class=nx>to</span> <span class=s>&#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2022-04-10-14-38-44/kube-apiserver.yaml&#34;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Waiting</span> <span class=k>for</span> <span class=nx>the</span> <span class=nx>kubelet</span> <span class=nx>to</span> <span class=nx>restart</span> <span class=nx>the</span> <span class=nx>component</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>This</span> <span class=nx>might</span> <span class=nx>take</span> <span class=nx>a</span> <span class=nx>minute</span> <span class=nx>or</span> <span class=nx>longer</span> <span class=nx>depending</span> <span class=nx>on</span> <span class=nx>the</span> <span class=nx>component</span><span class=o>/</span><span class=nx>version</span> <span class=nf>gap</span> <span class=p>(</span><span class=nx>timeout</span> <span class=mi>5</span><span class=nx>m0s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>Static</span> <span class=nx>pod</span><span class=p>:</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>apiserver</span><span class=o>-</span><span class=nx>k8s</span><span class=o>-</span><span class=nx>master02</span> <span class=nx>hash</span><span class=p>:</span> <span class=nx>bbdf76d8ed7bbfbefa3eb630aa51b714</span>
</span></span><span class=line><span class=cl><span class=err>…</span>
</span></span><span class=line><span class=cl><span class=nx>Static</span> <span class=nx>pod</span><span class=p>:</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>apiserver</span><span class=o>-</span><span class=nx>k8s</span><span class=o>-</span><span class=nx>master02</span> <span class=nx>hash</span><span class=p>:</span> <span class=nx>c74155fe1ef7591be36cfd2b246ca72a</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>apiclient</span><span class=p>]</span> <span class=nx>Found</span> <span class=mi>3</span> <span class=nx>Pods</span> <span class=k>for</span> <span class=nx>label</span> <span class=nx>selector</span> <span class=nx>component</span><span class=p>=</span><span class=nx>kube</span><span class=o>-</span><span class=nx>apiserver</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Component</span> <span class=s>&#34;kube-apiserver&#34;</span> <span class=nx>upgraded</span> <span class=nx>successfully</span><span class=p>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Preparing</span> <span class=k>for</span> <span class=s>&#34;kube-controller-manager&#34;</span> <span class=nx>upgrade</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Renewing</span> <span class=nx>controller</span><span class=o>-</span><span class=nx>manager</span><span class=p>.</span><span class=nx>conf</span> <span class=nx>certificate</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Moved</span> <span class=nx>new</span> <span class=nx>manifest</span> <span class=nx>to</span> <span class=s>&#34;/etc/kubernetes/manifests/kube-controller-manager.yaml&#34;</span> <span class=nx>and</span> <span class=nx>backed</span> <span class=nx>up</span> <span class=nx>old</span> <span class=nx>manifest</span> <span class=nx>to</span> <span class=s>&#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2022-04-10-14-38-44/kube-controller-manager.yaml&#34;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Waiting</span> <span class=k>for</span> <span class=nx>the</span> <span class=nx>kubelet</span> <span class=nx>to</span> <span class=nx>restart</span> <span class=nx>the</span> <span class=nx>component</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>This</span> <span class=nx>might</span> <span class=nx>take</span> <span class=nx>a</span> <span class=nx>minute</span> <span class=nx>or</span> <span class=nx>longer</span> <span class=nx>depending</span> <span class=nx>on</span> <span class=nx>the</span> <span class=nx>component</span><span class=o>/</span><span class=nx>version</span> <span class=nf>gap</span> <span class=p>(</span><span class=nx>timeout</span> <span class=mi>5</span><span class=nx>m0s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>Static</span> <span class=nx>pod</span><span class=p>:</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>controller</span><span class=o>-</span><span class=nx>manager</span><span class=o>-</span><span class=nx>k8s</span><span class=o>-</span><span class=nx>master02</span> <span class=nx>hash</span><span class=p>:</span> <span class=mi>96</span><span class=nx>d194097d7a0962788e7017657e9408</span>
</span></span><span class=line><span class=cl><span class=err>…</span>
</span></span><span class=line><span class=cl><span class=nx>Static</span> <span class=nx>pod</span><span class=p>:</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>controller</span><span class=o>-</span><span class=nx>manager</span><span class=o>-</span><span class=nx>k8s</span><span class=o>-</span><span class=nx>master02</span> <span class=nx>hash</span><span class=p>:</span> <span class=nx>c3371115cc8d680965a8dd1b9202a3ee</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>apiclient</span><span class=p>]</span> <span class=nx>Found</span> <span class=mi>3</span> <span class=nx>Pods</span> <span class=k>for</span> <span class=nx>label</span> <span class=nx>selector</span> <span class=nx>component</span><span class=p>=</span><span class=nx>kube</span><span class=o>-</span><span class=nx>controller</span><span class=o>-</span><span class=nx>manager</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Component</span> <span class=s>&#34;kube-controller-manager&#34;</span> <span class=nx>upgraded</span> <span class=nx>successfully</span><span class=p>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Preparing</span> <span class=k>for</span> <span class=s>&#34;kube-scheduler&#34;</span> <span class=nx>upgrade</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Renewing</span> <span class=nx>scheduler</span><span class=p>.</span><span class=nx>conf</span> <span class=nx>certificate</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Moved</span> <span class=nx>new</span> <span class=nx>manifest</span> <span class=nx>to</span> <span class=s>&#34;/etc/kubernetes/manifests/kube-scheduler.yaml&#34;</span> <span class=nx>and</span> <span class=nx>backed</span> <span class=nx>up</span> <span class=nx>old</span> <span class=nx>manifest</span> <span class=nx>to</span> <span class=s>&#34;/etc/kubernetes/tmp/kubeadm-backup-manifests-2022-04-10-14-38-44/kube-scheduler.yaml&#34;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Waiting</span> <span class=k>for</span> <span class=nx>the</span> <span class=nx>kubelet</span> <span class=nx>to</span> <span class=nx>restart</span> <span class=nx>the</span> <span class=nx>component</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>This</span> <span class=nx>might</span> <span class=nx>take</span> <span class=nx>a</span> <span class=nx>minute</span> <span class=nx>or</span> <span class=nx>longer</span> <span class=nx>depending</span> <span class=nx>on</span> <span class=nx>the</span> <span class=nx>component</span><span class=o>/</span><span class=nx>version</span> <span class=nf>gap</span> <span class=p>(</span><span class=nx>timeout</span> <span class=mi>5</span><span class=nx>m0s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>Static</span> <span class=nx>pod</span><span class=p>:</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>scheduler</span><span class=o>-</span><span class=nx>k8s</span><span class=o>-</span><span class=nx>master02</span> <span class=nx>hash</span><span class=p>:</span> <span class=mi>81</span><span class=nx>d2d21449d64d5e6d5e9069a7ca99ed</span>
</span></span><span class=line><span class=cl><span class=err>…</span><span class=nx>Static</span> <span class=nx>pod</span><span class=p>:</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>scheduler</span><span class=o>-</span><span class=nx>k8s</span><span class=o>-</span><span class=nx>master02</span> <span class=nx>hash</span><span class=p>:</span> <span class=mi>93632060532583</span><span class=nx>bc6e1b6f38dd64f10e</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>apiclient</span><span class=p>]</span> <span class=nx>Found</span> <span class=mi>3</span> <span class=nx>Pods</span> <span class=k>for</span> <span class=nx>label</span> <span class=nx>selector</span> <span class=nx>component</span><span class=p>=</span><span class=nx>kube</span><span class=o>-</span><span class=nx>scheduler</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=o>/</span><span class=nx>staticpods</span><span class=p>]</span> <span class=nx>Component</span> <span class=s>&#34;kube-scheduler&#34;</span> <span class=nx>upgraded</span> <span class=nx>successfully</span><span class=p>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=p>]</span> <span class=nx>The</span> <span class=nx>control</span> <span class=nx>plane</span> <span class=nx>instance</span> <span class=k>for</span> <span class=nx>this</span> <span class=nx>node</span> <span class=nx>was</span> <span class=nx>successfully</span> <span class=nx>updated</span><span class=p>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>kubelet</span><span class=o>-</span><span class=nx>start</span><span class=p>]</span> <span class=nx>Writing</span> <span class=nx>kubelet</span> <span class=nx>configuration</span> <span class=nx>to</span> <span class=nx>file</span> <span class=s>&#34;/var/lib/kubelet/config.yaml&#34;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=p>]</span> <span class=nx>The</span> <span class=nx>configuration</span> <span class=k>for</span> <span class=nx>this</span> <span class=nx>node</span> <span class=nx>was</span> <span class=nx>successfully</span> <span class=nx>updated</span><span class=p>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=p>]</span> <span class=nx>Now</span> <span class=nx>you</span> <span class=nx>should</span> <span class=k>go</span> <span class=nx>ahead</span> <span class=nx>and</span> <span class=nx>upgrade</span> <span class=nx>the</span> <span class=nx>kubelet</span> <span class=kn>package</span> <span class=nx>using</span> <span class=nx>your</span> <span class=kn>package</span> <span class=nx>manager</span><span class=p>.</span>
</span></span></code></pre></td></tr></table></div></div><ol start=8><li>Update kubectl and restart service</li></ol><p><code>apt-mark unhold kubelet && apt-get update && apt-get install -y kubelet=1.21.11-00 && apt-mark hold kubelet</code></p><p><code>systemctl restart kubelet</code></p><h3 id=checkpoint---master-nodes>Checkpoint - master nodes</h3><p>Now run <code>kubectl get nodes</code> should show all master nodes are having same version v1.21.11.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>NAME           STATUS   ROLES                  AGE    VERSION
</span></span><span class=line><span class=cl>k8s-master01   Ready    control-plane,master   368d   v1.21.11
</span></span><span class=line><span class=cl>k8s-master02   Ready    control-plane,master   32h    v1.21.11
</span></span><span class=line><span class=cl>k8s-master03   Ready    control-plane,master   368d   v1.21.11
</span></span><span class=line><span class=cl>k8s-node01     Ready    &lt;none&gt;                 368d   v1.20.5
</span></span></code></pre></td></tr></table></div></div><ol start=9><li>Update kubectl on all master nodes</li></ol><p><code>apt-mark unhold kubectl && apt-get update && apt-get install -y kubectl=1.21.11-00 && apt-mark hold kubectl</code></p><h3 id=upgrade-worker-nodes>Upgrade worker nodes</h3><p>There is only 1 node to update in my case</p><ol start=10><li>Update kubeadm on worker node</li></ol><p><code>apt-mark unhold kubeadm && apt-get update && apt-get install -y kubeadm=1.21.11-00 && apt-mark hold kubeadm</code></p><ol start=11><li>Drain worker node on MASTER machine</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl drain k8s-node01 --ignore-daemonsets
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#output
</span></span><span class=line><span class=cl>node/k8s-node01 cordoned
</span></span><span class=line><span class=cl>WARNING: ignoring DaemonSet-managed Pods: kube-system/kube-flannel-ds-cttj7, kube-system/kube-proxy-zmkml
</span></span><span class=line><span class=cl>evicting pod cert-manager/cert-manager-6588898cb4-bc4ks
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>evicting pod cert-manager/cert-manager-cainjector-7bcbdbd99f-j59b4
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>evicting pod ingress-nginx/ingress-nginx-controller-6d5cfc9f7d-wfr9t
</span></span><span class=line><span class=cl>evicting pod cert-manager/cert-manager-webhook-5fd9f9dd86-dx2qq
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>pod/cert-manager-cainjector-7bcbdbd99f-j59b4 evicted
</span></span><span class=line><span class=cl>I0410 15:12:22.003098   44940 request.go:655] Throttling request took 1.151010174s, request: GET:xxxx
</span></span><span class=line><span class=cl>pod/cert-manager-6588898cb4-bc4ks evicted
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>pod/cert-manager-webhook-5fd9f9dd86-dx2qq evicted
</span></span><span class=line><span class=cl>pod/ingress-nginx-controller-6d5cfc9f7d-wfr9t evicted
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>node/k8s-node01 evicted
</span></span></code></pre></td></tr></table></div></div><ol start=12><li>Apply upgrade to worker node</li></ol><p>On worker machine.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>kubeadm</span> <span class=nx>upgrade</span> <span class=nx>node</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span><span class=nx>output</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=p>]</span> <span class=nx>Reading</span> <span class=nx>configuration</span> <span class=nx>from</span> <span class=nx>the</span> <span class=nx>cluster</span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=p>]</span> <span class=nx>FYI</span><span class=p>:</span> <span class=nx>You</span> <span class=nx>can</span> <span class=nx>look</span> <span class=nx>at</span> <span class=nx>this</span> <span class=nx>config</span> <span class=nx>file</span> <span class=nx>with</span> <span class=err>&#39;</span><span class=nx>kubectl</span> <span class=o>-</span><span class=nx>n</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>system</span> <span class=nx>get</span> <span class=nx>cm</span> <span class=nx>kubeadm</span><span class=o>-</span><span class=nx>config</span> <span class=o>-</span><span class=nx>o</span> <span class=nx>yaml</span><span class=err>&#39;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>preflight</span><span class=p>]</span> <span class=nx>Running</span> <span class=nx>pre</span><span class=o>-</span><span class=nx>flight</span> <span class=nx>checks</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>preflight</span><span class=p>]</span> <span class=nx>Skipping</span> <span class=nx>prepull</span><span class=p>.</span> <span class=nx>Not</span> <span class=nx>a</span> <span class=nx>control</span> <span class=nx>plane</span> <span class=nx>node</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=p>]</span> <span class=nx>Skipping</span> <span class=nx>phase</span><span class=p>.</span> <span class=nx>Not</span> <span class=nx>a</span> <span class=nx>control</span> <span class=nx>plane</span> <span class=nx>node</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>kubelet</span><span class=o>-</span><span class=nx>start</span><span class=p>]</span> <span class=nx>Writing</span> <span class=nx>kubelet</span> <span class=nx>configuration</span> <span class=nx>to</span> <span class=nx>file</span> <span class=s>&#34;/var/lib/kubelet/config.yaml&#34;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=p>]</span> <span class=nx>The</span> <span class=nx>configuration</span> <span class=k>for</span> <span class=nx>this</span> <span class=nx>node</span> <span class=nx>was</span> <span class=nx>successfully</span> <span class=nx>updated</span><span class=p>!</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>upgrade</span><span class=p>]</span> <span class=nx>Now</span> <span class=nx>you</span> <span class=nx>should</span> <span class=k>go</span> <span class=nx>ahead</span> <span class=nx>and</span> <span class=nx>upgrade</span> <span class=nx>the</span> <span class=nx>kubelet</span> <span class=kn>package</span> <span class=nx>using</span> <span class=nx>your</span> <span class=kn>package</span> <span class=nx>manager</span><span class=p>.</span>
</span></span></code></pre></td></tr></table></div></div><ol start=13><li>Upgrade kubelet and restart service</li></ol><p><code>apt-mark unhold kubelet && apt-get update && apt-get install -y kubelet=1.21.11-00 && apt-mark hold kubelet</code></p><p><code>systemctl restart kubelet</code></p><ol start=14><li>Restore worker node</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl uncordon k8s-node01
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#output
</span></span><span class=line><span class=cl>node/k8s-node01 uncordoned
</span></span></code></pre></td></tr></table></div></div><h3 id=final-health-check>Final health check</h3><p>Run <code>kubectl get nodes</code> should show the following result.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>NAME           STATUS   ROLES                  AGE    VERSION
</span></span><span class=line><span class=cl>k8s-master01   Ready    control-plane,master   368d   v1.21.11
</span></span><span class=line><span class=cl>k8s-master02   Ready    control-plane,master   32h    v1.21.11
</span></span><span class=line><span class=cl>k8s-master03   Ready    control-plane,master   368d   v1.21.11
</span></span><span class=line><span class=cl>k8s-node01     Ready    &lt;none&gt;                 368d   v1.21.11
</span></span></code></pre></td></tr></table></div></div><h3 id=upgrade-also-containerdio>Upgrade also containerd.io</h3><p>If everything is fine, update the containerd.io to the latest version using the following command</p><p><code>apt-mark unhold containerd.io && apt-get update && apt-get install -y containerd.io && apt-mark hold containerd.io</code></p><h2 id=useful-command>Useful command</h2><ol><li>Check what version available for a package</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apt-cache madison containerd.io
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># output
</span></span><span class=line><span class=cl>containerd.io |   1.5.11-1 | https://download.docker.com/linux/ubuntu focal/stable arm64 Packages
</span></span><span class=line><span class=cl>containerd.io |   1.5.10-1 | https://download.docker.com/linux/ubuntu focal/stable arm64 Packages
</span></span><span class=line><span class=cl>containerd.io |   1.4.13-1 | https://download.docker.com/linux/ubuntu focal/stable arm64 Packages
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>Check current install version</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>apt</span><span class=o>-</span><span class=nx>get</span> <span class=o>-</span><span class=nx>s</span> <span class=nx>install</span> <span class=nx>containerd</span><span class=p>.</span><span class=nx>io</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>output</span>
</span></span><span class=line><span class=cl><span class=nx>NOTE</span><span class=p>:</span> <span class=nx>This</span> <span class=nx>is</span> <span class=nx>only</span> <span class=nx>a</span> <span class=nx>simulation</span><span class=p>!</span>
</span></span><span class=line><span class=cl>      <span class=nx>apt</span><span class=o>-</span><span class=nx>get</span> <span class=nx>needs</span> <span class=nx>root</span> <span class=nx>privileges</span> <span class=k>for</span> <span class=nx>real</span> <span class=nx>execution</span><span class=p>.</span>
</span></span><span class=line><span class=cl>      <span class=nx>Keep</span> <span class=nx>also</span> <span class=nx>in</span> <span class=nx>mind</span> <span class=nx>that</span> <span class=nx>locking</span> <span class=nx>is</span> <span class=nx>deactivated</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>so</span> <span class=nx>don</span><span class=err>&#39;</span><span class=nx>t</span> <span class=nx>depend</span> <span class=nx>on</span> <span class=nx>the</span> <span class=nx>relevance</span> <span class=nx>to</span> <span class=nx>the</span> <span class=nx>real</span> <span class=nx>current</span> <span class=nx>situation</span><span class=p>!</span>
</span></span><span class=line><span class=cl><span class=nx>Reading</span> <span class=kn>package</span> <span class=nx>lists</span><span class=o>...</span> <span class=nx>Done</span>
</span></span><span class=line><span class=cl><span class=nx>Building</span> <span class=nx>dependency</span> <span class=nx>tree</span>       
</span></span><span class=line><span class=cl><span class=nx>Reading</span> <span class=nx>state</span> <span class=nx>information</span><span class=o>...</span> <span class=nx>Done</span>
</span></span><span class=line><span class=cl><span class=nx>The</span> <span class=nx>following</span> <span class=nx>held</span> <span class=nx>packages</span> <span class=nx>will</span> <span class=nx>be</span> <span class=nx>changed</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=nx>containerd</span><span class=p>.</span><span class=nx>io</span>
</span></span><span class=line><span class=cl><span class=nx>The</span> <span class=nx>following</span> <span class=nx>packages</span> <span class=nx>will</span> <span class=nx>be</span> <span class=nx>upgraded</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=nx>containerd</span><span class=p>.</span><span class=nx>io</span>
</span></span><span class=line><span class=cl><span class=mi>1</span> <span class=nx>upgraded</span><span class=p>,</span> <span class=mi>0</span> <span class=nx>newly</span> <span class=nx>installed</span><span class=p>,</span> <span class=mi>0</span> <span class=nx>to</span> <span class=nx>remove</span> <span class=nx>and</span> <span class=mi>4</span> <span class=nx>not</span> <span class=nx>upgraded</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>Inst</span> <span class=nx>containerd</span><span class=p>.</span><span class=nx>io</span> <span class=p>[</span><span class=mf>1.4.4</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=p>(</span><span class=mf>1.5.11</span><span class=o>-</span><span class=mi>1</span> <span class=nx>Docker</span> <span class=nx>CE</span><span class=p>:</span><span class=nx>focal</span> <span class=p>[</span><span class=nx>arm64</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nx>Conf</span> <span class=nx>containerd</span><span class=p>.</span><span class=nf>io</span> <span class=p>(</span><span class=mf>1.5.11</span><span class=o>-</span><span class=mi>1</span> <span class=nx>Docker</span> <span class=nx>CE</span><span class=p>:</span><span class=nx>focal</span> <span class=p>[</span><span class=nx>arm64</span><span class=p>])</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=reference>Reference</h2><p>[1] <a href=https://platform9.com/blog/kubernetes-upgrade-the-definitive-guide-to-do-it-yourself/ target=_blank rel="noopener noreffer">https://platform9.com/blog/kubernetes-upgrade-the-definitive-guide-to-do-it-yourself/</a></p><p>[2] <a href=https://www.lisenet.com/2021/upgrading-homelab-kubernetes-cluster-from-1-20-to-1-21/ target=_blank rel="noopener noreffer">https://www.lisenet.com/2021/upgrading-homelab-kubernetes-cluster-from-1-20-to-1-21/</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/blog/upgrade-k8s-v120/index.md target=_blank></a></span></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/computer-science/>computer science</a>,&nbsp;<a href=/tags/infrastructure/>infrastructure</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()></a></span>&nbsp;|&nbsp;<span><a href=/></a></span></section></div><div class=post-nav><a href=/blog/multi-node-k8s-failed/ class=prev rel=prev title="3 nodes Kubernetes cluster failed due to cert error"><i class="fas fa-angle-left fa-fw"></i>3 nodes Kubernetes cluster failed due to cert error</a>
<a href=/blog/k8s-move-to-containerd/ class=next rel=next title="Kubernetes move from docker to containerd">Kubernetes move from docker to containerd<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2016 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Lai Yiu Ming, Tom</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"",maxShownLines:100},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>